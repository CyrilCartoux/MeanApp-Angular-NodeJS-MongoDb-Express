function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{McEk:function(t,e,n){"use strict";n.r(e);var i,a,o=n("fXoL"),r=n("N/25"),s=n("tyNb"),c=((i=function(){function t(e,n){_classCallCheck(this,t),this.authService=e,this.router=n,this.isLoggedIn=!1}return _createClass(t,[{key:"canActivate",value:function(t,e){return this.isLoggedIn=this.authService.getIsAuth(),this.isLoggedIn||this.router.navigate(["/auth/login"]),!0}}]),t}()).\u0275fac=function(t){return new(t||i)(o.Wb(r.a),o.Wb(s.c))},i.\u0275prov=o.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),u=n("XNiG"),p=n("lJxs"),l=n("AytR"),f=n("tk/3"),g=l.a.apiUrl+"api/posts/",d=((a=function(){function t(e,n){_classCallCheck(this,t),this.http=e,this.router=n,this.posts=[],this.postsUpdated=new u.a}return _createClass(t,[{key:"getPosts",value:function(t,e){var n=this;this.http.get(g+"?pagesize=".concat(t,"&page=").concat(e)).pipe(Object(p.a)((function(t){return{posts:t.posts.map((function(t){return{title:t.title,content:t.content,id:t._id,imagePath:t.imagePath,creator:t.creator}})),maxPosts:t.maxPosts}}))).subscribe((function(t){n.posts=t.posts,n.postsUpdated.next({posts:_toConsumableArray(n.posts),postCount:t.maxPosts})}))}},{key:"getPostUpdateListener",value:function(){return this.postsUpdated.asObservable()}},{key:"getPost",value:function(t){return this.http.get(g+t)}},{key:"addPost",value:function(t,e,n){var i=this,a=new FormData;a.append("title",t),a.append("content",e),a.append("image",n,t),this.http.post(g,a).subscribe((function(t){i.router.navigate(["/"])}))}},{key:"updatePost",value:function(t,e,n,i){var a,o=this;"object"==typeof i?((a=new FormData).append("id",t),a.append("title",e),a.append("content",n),a.append("image",i,e)):a={id:t,title:e,content:n,imagePath:i},this.http.put(g+t,a).subscribe((function(){o.router.navigate(["/"])}))}},{key:"deletePost",value:function(t){return this.http.delete(g+t)}}]),t}()).\u0275fac=function(t){return new(t||a)(o.Wb(f.b),o.Wb(s.c))},a.\u0275prov=o.Jb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),b=n("ofXK"),h=n("Xa2L"),m=n("7EHt"),v=n("bTqV"),y=n("M9IT");function P(t,e){1&t&&o.Ob(0,"mat-spinner")}var S=function(t){return["/edit",t]};function I(t,e){if(1&t){var n=o.Tb();o.Sb(0,"mat-action-row"),o.Sb(1,"a",8),o.wc(2,"EDIT"),o.Rb(),o.Sb(3,"button",9),o.ac("click",(function(){o.pc(n);var t=o.ec().$implicit;return o.ec(2).onDelete(t.id)})),o.wc(4,"DELETE"),o.Rb(),o.Rb()}if(2&t){var i=o.ec().$implicit;o.Bb(1),o.jc("routerLink",o.kc(1,S,i.id))}}function k(t,e){if(1&t&&(o.Sb(0,"mat-expansion-panel"),o.Sb(1,"mat-expansion-panel-header"),o.wc(2),o.Rb(),o.Sb(3,"div",6),o.Ob(4,"img",7),o.Rb(),o.Sb(5,"p"),o.wc(6),o.Rb(),o.vc(7,I,5,3,"mat-action-row",0),o.Rb()),2&t){var n=e.$implicit,i=o.ec(2);o.Bb(2),o.yc(" ",n.title," "),o.Bb(2),o.jc("src",n.imagePath,o.qc)("alt",n.title),o.Bb(2),o.xc(n.content),o.Bb(1),o.jc("ngIf",i.isLoggedIn&&n.creator===i.userId)}}function w(t,e){if(1&t&&(o.Sb(0,"mat-accordion",4),o.vc(1,k,8,5,"mat-expansion-panel",5),o.Rb()),2&t){var n=o.ec();o.Bb(1),o.jc("ngForOf",n.posts)}}function C(t,e){if(1&t){var n=o.Tb();o.Sb(0,"mat-paginator",10),o.ac("page",(function(t){return o.pc(n),o.ec().onChangedPage(t)})),o.Rb()}if(2&t){var i=o.ec();o.jc("length",i.totalPosts)("pageSize",i.postsPerPage)("pageSizeOptions",i.pageSizeOptions)}}function _(t,e){1&t&&(o.Sb(0,"p",11),o.wc(1,"No posts added yet!"),o.Rb())}var L,O=((L=function(){function t(e,n){_classCallCheck(this,t),this.postsService=e,this.authService=n,this.isLoggedIn=!1,this.posts=[],this.isLoading=!1,this.totalPosts=0,this.postsPerPage=2,this.currentPage=1,this.pageSizeOptions=[1,2,5,10]}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.userId=this.authService.getUserId(),this.isLoading=!0,this.postsService.getPosts(this.postsPerPage,this.currentPage),this.authStatusSub=this.authService.getAuthStatus().subscribe((function(e){t.isLoggedIn=e,t.userId=t.authService.getUserId()})),this.isLoggedIn=this.authService.getIsAuth(),this.postsSub=this.postsService.getPostUpdateListener().subscribe((function(e){t.isLoading=!1,t.totalPosts=e.postCount,t.posts=e.posts}))}},{key:"onChangedPage",value:function(t){this.isLoading=!0,this.currentPage=t.pageIndex+1,this.postsPerPage=t.pageSize,this.postsService.getPosts(this.postsPerPage,this.currentPage)}},{key:"onDelete",value:function(t){var e=this;this.isLoading=!0,this.postsService.deletePost(t).subscribe((function(){e.postsService.getPosts(e.postsPerPage,e.currentPage)}),(function(){e.isLoading=!1}))}},{key:"ngOnDestroy",value:function(){this.postsSub.unsubscribe(),this.authStatusSub.unsubscribe()}}]),t}()).\u0275fac=function(t){return new(t||L)(o.Nb(d),o.Nb(r.a))},L.\u0275cmp=o.Hb({type:L,selectors:[["app-post-list"]],decls:4,vars:4,consts:[[4,"ngIf"],["multi","true",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["class","info-text mat-body-1",4,"ngIf"],["multi","true"],[4,"ngFor","ngForOf"],[1,"post-image"],[3,"src","alt"],["mat-button","","color","primary",3,"routerLink"],["mat-button","","color","warn",3,"click"],[3,"length","pageSize","pageSizeOptions","page"],[1,"info-text","mat-body-1"]],template:function(t,e){1&t&&(o.vc(0,P,1,0,"mat-spinner",0),o.vc(1,w,2,1,"mat-accordion",1),o.vc(2,C,1,3,"mat-paginator",2),o.vc(3,_,2,0,"p",3)),2&t&&(o.jc("ngIf",e.isLoading),o.Bb(1),o.jc("ngIf",e.posts.length>0&&!e.isLoading),o.Bb(1),o.jc("ngIf",e.posts.length>0),o.Bb(1),o.jc("ngIf",e.posts.length<=0&&!e.isLoading))},directives:[b.k,h.b,m.a,b.j,m.c,m.e,m.d,v.a,s.e,v.b,y.a],styles:["[_nghost-%COMP%]{display:block;margin-top:1rem}.info-text[_ngcontent-%COMP%]{text-align:center}mat-spinner[_ngcontent-%COMP%]{margin:auto}mat-paginator[_ngcontent-%COMP%]{margin-top:1rem}.post-image[_ngcontent-%COMP%]{height:5rem;margin:1rem 0}.post-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]}),L),A=n("3Pt+"),j=n("LRne"),R=n("HDdC"),M=function(t){if("string"==typeof t.value)return Object(j.a)(null);var e=t.value,n=new FileReader;return R.a.create((function(t){n.addEventListener("loadend",(function(){for(var e=new Uint8Array(n.result).subarray(0,4),i="",a=!1,o=0;o<e.length;o++)i+=e[o].toString(16);switch(i){case"89504e47":a=!0;break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":a=!0;break;default:a=!1}t.next(a?null:{invalidMimeType:!0}),t.complete()})),n.readAsArrayBuffer(e)}))},T=n("Wp6s"),x=n("kmnG"),B=n("qFsG");function U(t,e){1&t&&o.Ob(0,"mat-spinner")}function z(t,e){1&t&&(o.Sb(0,"mat-error"),o.wc(1,"Please enter a post title."),o.Rb())}function N(t,e){if(1&t&&(o.Sb(0,"div",10),o.Ob(1,"img",11),o.Rb()),2&t){var n=o.ec(2);o.Bb(1),o.jc("src",n.imagePreview,o.qc)("alt",n.form.value.title)}}function D(t,e){1&t&&(o.Sb(0,"mat-error"),o.wc(1,"Please enter a post title."),o.Rb())}function E(t,e){if(1&t){var n=o.Tb();o.Sb(0,"form",2),o.ac("submit",(function(){return o.pc(n),o.ec().onSavePost()})),o.Sb(1,"mat-form-field"),o.Ob(2,"input",3),o.vc(3,z,2,0,"mat-error",0),o.Rb(),o.Sb(4,"div"),o.Sb(5,"button",4),o.ac("click",(function(){return o.pc(n),o.nc(8).click()})),o.wc(6,"Pick Image"),o.Rb(),o.Sb(7,"input",5,6),o.ac("change",(function(t){return o.pc(n),o.ec().onImagePicked(t)})),o.Rb(),o.Rb(),o.vc(9,N,2,2,"div",7),o.Sb(10,"mat-form-field"),o.Ob(11,"textarea",8),o.vc(12,D,2,0,"mat-error",0),o.Rb(),o.Sb(13,"button",9),o.wc(14,"Save Post"),o.Rb(),o.Rb()}if(2&t){var i=o.ec();o.jc("formGroup",i.form),o.Bb(3),o.jc("ngIf",i.form.get("title").invalid),o.Bb(6),o.jc("ngIf",""!==i.imagePreview&&i.imagePreview&&i.form.get("image").valid),o.Bb(3),o.jc("ngIf",i.form.get("content").invalid)}}var F,q,W=((F=function(){function t(e,n){_classCallCheck(this,t),this.postsService=e,this.route=n,this.enteredTitle="",this.enteredContent="",this.isLoading=!1,this.mode="create"}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.form=new A.e({title:new A.c(null,{validators:[A.o.required,A.o.minLength(3)]}),content:new A.c(null,{validators:[A.o.required]}),image:new A.c(null,{validators:[A.o.required],asyncValidators:[M]})}),this.route.paramMap.subscribe((function(e){e.has("postId")?(t.mode="edit",t.postId=e.get("postId"),t.isLoading=!0,t.postsService.getPost(t.postId).subscribe((function(e){t.isLoading=!1,t.post={id:e._id,title:e.title,content:e.content,imagePath:e.imagePath},t.form.setValue({title:t.post.title,content:t.post.content,image:t.post.imagePath})}))):(t.mode="create",t.postId=null)}))}},{key:"onImagePicked",value:function(t){var e=this,n=t.target.files[0];this.form.patchValue({image:n}),this.form.get("image").updateValueAndValidity();var i=new FileReader;i.onload=function(){e.imagePreview=i.result},i.readAsDataURL(n)}},{key:"onSavePost",value:function(){this.form.invalid||(this.isLoading=!0,"create"===this.mode?(this.postsService.addPost(this.form.value.title,this.form.value.content,this.form.value.image),this.isLoading=!1):(this.postsService.updatePost(this.postId,this.form.value.title,this.form.value.content,this.form.value.image),this.isLoading=!1),this.form.reset())}}]),t}()).\u0275fac=function(t){return new(t||F)(o.Nb(d),o.Nb(s.a))},F.\u0275cmp=o.Hb({type:F,selectors:[["app-post-create"]],decls:3,vars:2,consts:[[4,"ngIf"],[3,"formGroup","submit",4,"ngIf"],[3,"formGroup","submit"],["matInput","","type","text","formControlName","title","placeholder","Post Title"],["mat-stroked-button","","type","button",3,"click"],["type","file",3,"change"],["filePicker",""],["class","image-preview",4,"ngIf"],["matInput","","rows","4","formControlName","content","placeholder","Post Content"],["mat-raised-button","","color","accent","type","submit"],[1,"image-preview"],[3,"src","alt"]],template:function(t,e){1&t&&(o.Sb(0,"mat-card"),o.vc(1,U,1,0,"mat-spinner",0),o.vc(2,E,15,4,"form",1),o.Rb()),2&t&&(o.Bb(1),o.jc("ngIf",e.isLoading),o.Bb(1),o.jc("ngIf",!e.isLoading))},directives:[T.a,b.k,h.b,A.p,A.j,A.f,x.c,B.a,A.a,A.i,A.d,v.b,x.b],styles:["mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin:auto}input[type=file][_ngcontent-%COMP%]{visibility:hidden}.image-preview[_ngcontent-%COMP%]{height:5rem;margin:1rem 0}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]}),F),G=[{path:"",component:O},{path:"create",component:W,canActivate:[c]},{path:"edit/:postId",component:W,canActivate:[c]}],H=((q=function t(){_classCallCheck(this,t)}).\u0275mod=o.Lb({type:q}),q.\u0275inj=o.Kb({factory:function(t){return new(t||q)},imports:[[s.f.forChild(G)],s.f]}),q),V=n("SMCv");n.d(e,"PostModule",(function(){return X}));var J,X=((J=function t(){_classCallCheck(this,t)}).\u0275mod=o.Lb({type:J}),J.\u0275inj=o.Kb({factory:function(t){return new(t||J)},imports:[[b.c,A.m,V.a,s.f,H]]}),J)}}]);