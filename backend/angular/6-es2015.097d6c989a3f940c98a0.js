(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{McEk:function(t,e,i){"use strict";i.r(e);var s=i("fXoL"),n=i("N/25"),o=i("tyNb");let a=(()=>{class t{constructor(t,e){this.authService=t,this.router=e,this.isLoggedIn=!1}canActivate(t,e){return this.isLoggedIn=this.authService.getIsAuth(),this.isLoggedIn||this.router.navigate(["/auth/login"]),!0}}return t.\u0275fac=function(e){return new(e||t)(s.Wb(n.a),s.Wb(o.c))},t.\u0275prov=s.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var r=i("XNiG"),c=i("lJxs"),p=i("AytR"),g=i("tk/3");const u=p.a.apiUrl+"api/posts/";let h=(()=>{class t{constructor(t,e){this.http=t,this.router=e,this.posts=[],this.postsUpdated=new r.a}getPosts(t,e){this.http.get(u+`?pagesize=${t}&page=${e}`).pipe(Object(c.a)(t=>({posts:t.posts.map(t=>({title:t.title,content:t.content,id:t._id,imagePath:t.imagePath,creator:t.creator})),maxPosts:t.maxPosts}))).subscribe(t=>{this.posts=t.posts,this.postsUpdated.next({posts:[...this.posts],postCount:t.maxPosts})})}getPostUpdateListener(){return this.postsUpdated.asObservable()}getPost(t){return this.http.get(u+t)}addPost(t,e,i){const s=new FormData;s.append("title",t),s.append("content",e),s.append("image",i,t),this.http.post(u,s).subscribe(t=>{this.router.navigate(["/"])})}updatePost(t,e,i,s){let n;"object"==typeof s?(n=new FormData,n.append("id",t),n.append("title",e),n.append("content",i),n.append("image",s,e)):n={id:t,title:e,content:i,imagePath:s},this.http.put(u+t,n).subscribe(()=>{this.router.navigate(["/"])})}deletePost(t){return this.http.delete(u+t)}}return t.\u0275fac=function(e){return new(e||t)(s.Wb(g.b),s.Wb(o.c))},t.\u0275prov=s.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var d=i("ofXK"),l=i("Xa2L"),m=i("7EHt"),b=i("bTqV"),f=i("M9IT");function v(t,e){1&t&&s.Ob(0,"mat-spinner")}const P=function(t){return["/edit",t]};function S(t,e){if(1&t){const t=s.Tb();s.Sb(0,"mat-action-row"),s.Sb(1,"a",8),s.wc(2,"EDIT"),s.Rb(),s.Sb(3,"button",9),s.ac("click",(function(){s.pc(t);const e=s.ec().$implicit;return s.ec(2).onDelete(e.id)})),s.wc(4,"DELETE"),s.Rb(),s.Rb()}if(2&t){const t=s.ec().$implicit;s.Bb(1),s.jc("routerLink",s.kc(1,P,t.id))}}function I(t,e){if(1&t&&(s.Sb(0,"mat-expansion-panel"),s.Sb(1,"mat-expansion-panel-header"),s.wc(2),s.Rb(),s.Sb(3,"div",6),s.Ob(4,"img",7),s.Rb(),s.Sb(5,"p"),s.wc(6),s.Rb(),s.vc(7,S,5,3,"mat-action-row",0),s.Rb()),2&t){const t=e.$implicit,i=s.ec(2);s.Bb(2),s.yc(" ",t.title," "),s.Bb(2),s.jc("src",t.imagePath,s.qc)("alt",t.title),s.Bb(2),s.xc(t.content),s.Bb(1),s.jc("ngIf",i.isLoggedIn&&t.creator===i.userId)}}function w(t,e){if(1&t&&(s.Sb(0,"mat-accordion",4),s.vc(1,I,8,5,"mat-expansion-panel",5),s.Rb()),2&t){const t=s.ec();s.Bb(1),s.jc("ngForOf",t.posts)}}function L(t,e){if(1&t){const t=s.Tb();s.Sb(0,"mat-paginator",10),s.ac("page",(function(e){return s.pc(t),s.ec().onChangedPage(e)})),s.Rb()}if(2&t){const t=s.ec();s.jc("length",t.totalPosts)("pageSize",t.postsPerPage)("pageSizeOptions",t.pageSizeOptions)}}function y(t,e){1&t&&(s.Sb(0,"p",11),s.wc(1,"No posts added yet!"),s.Rb())}let O=(()=>{class t{constructor(t,e){this.postsService=t,this.authService=e,this.isLoggedIn=!1,this.posts=[],this.isLoading=!1,this.totalPosts=0,this.postsPerPage=2,this.currentPage=1,this.pageSizeOptions=[1,2,5,10]}ngOnInit(){this.userId=this.authService.getUserId(),this.isLoading=!0,this.postsService.getPosts(this.postsPerPage,this.currentPage),this.authStatusSub=this.authService.getAuthStatus().subscribe(t=>{this.isLoggedIn=t,this.userId=this.authService.getUserId()}),this.isLoggedIn=this.authService.getIsAuth(),this.postsSub=this.postsService.getPostUpdateListener().subscribe(t=>{this.isLoading=!1,this.totalPosts=t.postCount,this.posts=t.posts})}onChangedPage(t){this.isLoading=!0,this.currentPage=t.pageIndex+1,this.postsPerPage=t.pageSize,this.postsService.getPosts(this.postsPerPage,this.currentPage)}onDelete(t){this.isLoading=!0,this.postsService.deletePost(t).subscribe(()=>{this.postsService.getPosts(this.postsPerPage,this.currentPage)},()=>{this.isLoading=!1})}ngOnDestroy(){this.postsSub.unsubscribe(),this.authStatusSub.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(h),s.Nb(n.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["app-post-list"]],decls:4,vars:4,consts:[[4,"ngIf"],["multi","true",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["class","info-text mat-body-1",4,"ngIf"],["multi","true"],[4,"ngFor","ngForOf"],[1,"post-image"],[3,"src","alt"],["mat-button","","color","primary",3,"routerLink"],["mat-button","","color","warn",3,"click"],[3,"length","pageSize","pageSizeOptions","page"],[1,"info-text","mat-body-1"]],template:function(t,e){1&t&&(s.vc(0,v,1,0,"mat-spinner",0),s.vc(1,w,2,1,"mat-accordion",1),s.vc(2,L,1,3,"mat-paginator",2),s.vc(3,y,2,0,"p",3)),2&t&&(s.jc("ngIf",e.isLoading),s.Bb(1),s.jc("ngIf",e.posts.length>0&&!e.isLoading),s.Bb(1),s.jc("ngIf",e.posts.length>0),s.Bb(1),s.jc("ngIf",e.posts.length<=0&&!e.isLoading))},directives:[d.k,l.b,m.a,d.j,m.c,m.e,m.d,b.a,o.e,b.b,f.a],styles:["[_nghost-%COMP%]{display:block;margin-top:1rem}.info-text[_ngcontent-%COMP%]{text-align:center}mat-spinner[_ngcontent-%COMP%]{margin:auto}mat-paginator[_ngcontent-%COMP%]{margin-top:1rem}.post-image[_ngcontent-%COMP%]{height:5rem;margin:1rem 0}.post-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]}),t})();var R=i("3Pt+"),k=i("LRne"),C=i("HDdC");const j=t=>{if("string"==typeof t.value)return Object(k.a)(null);const e=t.value,i=new FileReader;return C.a.create(t=>{i.addEventListener("loadend",()=>{const e=new Uint8Array(i.result).subarray(0,4);let s="",n=!1;for(let t=0;t<e.length;t++)s+=e[t].toString(16);switch(s){case"89504e47":n=!0;break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":n=!0;break;default:n=!1}t.next(n?null:{invalidMimeType:!0}),t.complete()}),i.readAsArrayBuffer(e)})};var M=i("Wp6s"),x=i("kmnG"),B=i("qFsG");function _(t,e){1&t&&s.Ob(0,"mat-spinner")}function A(t,e){1&t&&(s.Sb(0,"mat-error"),s.wc(1,"Please enter a post title."),s.Rb())}function z(t,e){if(1&t&&(s.Sb(0,"div",10),s.Ob(1,"img",11),s.Rb()),2&t){const t=s.ec(2);s.Bb(1),s.jc("src",t.imagePreview,s.qc)("alt",t.form.value.title)}}function N(t,e){1&t&&(s.Sb(0,"mat-error"),s.wc(1,"Please enter a post title."),s.Rb())}function T(t,e){if(1&t){const t=s.Tb();s.Sb(0,"form",2),s.ac("submit",(function(){return s.pc(t),s.ec().onSavePost()})),s.Sb(1,"mat-form-field"),s.Ob(2,"input",3),s.vc(3,A,2,0,"mat-error",0),s.Rb(),s.Sb(4,"div"),s.Sb(5,"button",4),s.ac("click",(function(){return s.pc(t),s.nc(8).click()})),s.wc(6,"Pick Image"),s.Rb(),s.Sb(7,"input",5,6),s.ac("change",(function(e){return s.pc(t),s.ec().onImagePicked(e)})),s.Rb(),s.Rb(),s.vc(9,z,2,2,"div",7),s.Sb(10,"mat-form-field"),s.Ob(11,"textarea",8),s.vc(12,N,2,0,"mat-error",0),s.Rb(),s.Sb(13,"button",9),s.wc(14,"Save Post"),s.Rb(),s.Rb()}if(2&t){const t=s.ec();s.jc("formGroup",t.form),s.Bb(3),s.jc("ngIf",t.form.get("title").invalid),s.Bb(6),s.jc("ngIf",""!==t.imagePreview&&t.imagePreview&&t.form.get("image").valid),s.Bb(3),s.jc("ngIf",t.form.get("content").invalid)}}let U=(()=>{class t{constructor(t,e){this.postsService=t,this.route=e,this.enteredTitle="",this.enteredContent="",this.isLoading=!1,this.mode="create"}ngOnInit(){this.form=new R.e({title:new R.c(null,{validators:[R.o.required,R.o.minLength(3)]}),content:new R.c(null,{validators:[R.o.required]}),image:new R.c(null,{validators:[R.o.required],asyncValidators:[j]})}),this.route.paramMap.subscribe(t=>{t.has("postId")?(this.mode="edit",this.postId=t.get("postId"),this.isLoading=!0,this.postsService.getPost(this.postId).subscribe(t=>{this.isLoading=!1,this.post={id:t._id,title:t.title,content:t.content,imagePath:t.imagePath},this.form.setValue({title:this.post.title,content:this.post.content,image:this.post.imagePath})})):(this.mode="create",this.postId=null)})}onImagePicked(t){const e=t.target.files[0];this.form.patchValue({image:e}),this.form.get("image").updateValueAndValidity();const i=new FileReader;i.onload=()=>{this.imagePreview=i.result},i.readAsDataURL(e)}onSavePost(){this.form.invalid||(this.isLoading=!0,"create"===this.mode?(this.postsService.addPost(this.form.value.title,this.form.value.content,this.form.value.image),this.isLoading=!1):(this.postsService.updatePost(this.postId,this.form.value.title,this.form.value.content,this.form.value.image),this.isLoading=!1),this.form.reset())}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(h),s.Nb(o.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["app-post-create"]],decls:3,vars:2,consts:[[4,"ngIf"],[3,"formGroup","submit",4,"ngIf"],[3,"formGroup","submit"],["matInput","","type","text","formControlName","title","placeholder","Post Title"],["mat-stroked-button","","type","button",3,"click"],["type","file",3,"change"],["filePicker",""],["class","image-preview",4,"ngIf"],["matInput","","rows","4","formControlName","content","placeholder","Post Content"],["mat-raised-button","","color","accent","type","submit"],[1,"image-preview"],[3,"src","alt"]],template:function(t,e){1&t&&(s.Sb(0,"mat-card"),s.vc(1,_,1,0,"mat-spinner",0),s.vc(2,T,15,4,"form",1),s.Rb()),2&t&&(s.Bb(1),s.jc("ngIf",e.isLoading),s.Bb(1),s.jc("ngIf",!e.isLoading))},directives:[M.a,d.k,l.b,R.p,R.j,R.f,x.c,B.a,R.a,R.i,R.d,b.b,x.b],styles:["mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin:auto}input[type=file][_ngcontent-%COMP%]{visibility:hidden}.image-preview[_ngcontent-%COMP%]{height:5rem;margin:1rem 0}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]}),t})();const D=[{path:"",component:O},{path:"create",component:U,canActivate:[a]},{path:"edit/:postId",component:U,canActivate:[a]}];let F=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)},imports:[[o.f.forChild(D)],o.f]}),t})();var q=i("SMCv");i.d(e,"PostModule",(function(){return E}));let E=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)},imports:[[d.c,R.m,q.a,o.f,F]]}),t})()}}]);